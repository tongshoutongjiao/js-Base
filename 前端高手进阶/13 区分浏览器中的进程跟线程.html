<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .gpu {
            background-color: darkgreen;
            width: 50px;
            height: 50px;
            transform: translate(0, 0);
            animation: slide 3.7s ease-in-out infinite;
        }

        @keyframes slide {
            25% {
                transform: translate(250px, 0);
            }

            50% {
                transform: translate(250px, 250px);
            }

            75% {
                transform: translate(0, 250px);
            }
        }
    </style>
</head>

<body>
    <div>
        浏览器作为前端代码运行的环境，也作为前端工程师的底层知识，熟悉它的结构及工作方式，无论是对于开发高性能 Web
        应用，还是对于建立完善的前端知识框架，都起着至关重要的作用。这一课时我们就通过学习浏览器中的进程和线程来掌握它的整体架构。
    </div>
    <div>
        <h2>进程（Process）与线程（Thread） </h2>
        <div>
            我们先来好好梳理一下关于进程和线程的相关概念。<br>
            进程是操作系统进行资源分配和调度的基本单位，线程是操作系统进行运算的最小单位。
            一个程序至少有一个进程，一个进程至少有一个线程。线程需要由进程来启动和管理。
        </div>
    </div>
    <div>
        <p>
            通常程序需要执行多个任务，比如浏览器需要一边渲染页面一边请求后端数据同时还要响应用户事件，而单线程的进程在同一时间内只能执行一个任务，无法满足多个任务并行执行的需求。要解决这个问题，可以通过 3 种方式来实现：

            多进程

            多线程（同一进程）

            多进程和多线程

            由于第 3 种方式是前两种方式的结合，所以这里只比较多进程和多线程的特点。

            前面提到进程是操作系统资源分配的基本单位，这里隐含的意思就是，不同进程之间的资源是独享的，不可以相互访问。这种特性带来的最大好处就是建立了进程之间的隔离性，避免了多个进程同时操作同一份数据而产生问题。

            而多线程没有分配独立的资源，线程之间数据都是共享的，也就意味着创建线程的成本更小，因为不需要分配额外的存储空间。但线程的数据共享也带来了很多问题：首先是稳定性，进程中任意线程崩溃都会导致整个进程的崩溃，也就是说会“牵连”到进程中的其他线程。安全隐患就更容易理解了，如果有恶意线程启动，可以随意访问进程中的任意资源。

            总而言之，多线程更轻量，多进程更安全更稳定。

        </p>
        <div>
            浏览器进程 <br>
            浏览器的主进程负责界⾯显⽰（地址栏、导航栏、书签等）、处理用户事件、管理⼦进程等。

            GPU 进程 <br>
            处理来自其他进程的 GPU 任务，比如来自渲染进程或扩展程序进程的 CSS3 动画效果，来自浏览器进程的界面绘制等。

            在第 06 课时中提到过浏览器渲染页面的过程，在最后一个步骤“绘制”中我们提到了图层的合成，而这个图层的合成操作其实就是交给 GPU 进程来完成的。

            它还有一个重要的特性，那就是可以利用 GPU 硬件来加速渲染，包括 Canvas 绘制、CSS3 转换（Transitions）、CSS3 变换（Transforms）、WebGL 等。具体原理就是如果 DOM
            元素使用了这些属性，GPU 进程就会在合成层的时候对它进行单独处理，提升到一个独立的层进行绘制，这样就能避免重新布局和重新绘制。
        </div>


    </div>
    <div class="gpu"></div>
    <div>
        <h2> 渲染进程</h2>

        浏览器会为每个标签页单独启动一个渲染进程，所以它和上述进程不同，并不是唯一的。

        渲染进程的任务是将 HTML、CSS 和 JavaScript 转化为⽤户可以与之交互的网页，每个渲染进程都会启动单独的渲染引擎线程和 JavaScript 引擎线程。关于渲染引擎的工作细节我们在第 06
        课时中已经详细讨论过了，JavaScript 引擎线程也在第 12 课时中详细讨论过，这里就不重复讨论了。

        除此之外还包括事件触发线程，负责接收事件，并将回调函数放入 JavaScript 引擎线程的事件队列中，以及负责处理定时任务的定时器线程。

        这种设计保障了程序与系统的安全性，可以通过操作系统提供的权限机制来为每个渲染进程建立一个沙箱运行环境，从而防止恶意破坏用户系统或影响其他标签页的行为。

        同时也保障了渲染进程的稳定性，因为如果某个标签页失去响应，用户可以关掉这个标签页，此时其他标签页依然运行着，可以正常使用。如果所有标签页都运行在同一进程上，那么当某个失去响应，所有标签页都会失去响应。
    </div>
    <div>
        这一课时我们分析了 Chrome 浏览器的架构，至少可以得到以下 3 个启示：

        多进程在稳定性和安全性上有优势，但是资源占用较多；

        对于复杂的应用我们可以采取服务化的设计方式，将功能模块单独拆分成进程来提供服务；

        合理利用 GPU 进程可以加速渲染。
    </div>
    <script>

    </script>

</body>

</html>